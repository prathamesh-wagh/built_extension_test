var onHeaders = require('on-headers');
/*
  Middleware for calculating the total response time.
  Borrowed from:
    http://www.senchalabs.org/connect/responseTime.html
*/
module.exports = function(req, res, next){
  var start = new Date

  if (res._responseTime) return next()
  res._responseTime = true

  onHeaders(res, function() {
    var duration = new Date - start
    res.setHeader('X-Runtime', duration + 'ms')
  })

  next()
}